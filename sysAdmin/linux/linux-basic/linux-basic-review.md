---
tags:
  - linux
---
# Linux-basic-review

## Linux 是什么

## 主机规划与磁盘分区

## 安装 CentOS 7

### 回顾

- 建议安装时至少有 `/`,`/boot`, `/home`, `swap` 四个分区

- CentOS 7安装模式至少有两种，分别是图形与命令行

- CentOS 7若小于2T硬盘，默认使用MBR模式，当然也可以强迫使用GPT

- 自行规划分区

- 一般swap大小为1.5~2倍的物理内存

- CentOS 7默认使用 xfs 文件系统

- 不启用kdump，因为是核心开发者查阅死机数据

- 尽量使用一般用户，有必要再转身份成为root

- root 密码不要随便设置！即使是联系机

### 练习



## 首次登录与帮助信息

### 回顾

- 为了避免瞬间断电造成的Linux系统危害，建议做为服务器的Linux主机应该加上不断电系统来持续提供稳定的电力；
- 养成良好的操作习惯，尽量不要使用 root 直接登陆系统，应使用一般帐号登陆系统，有需要再转换身份
- 可以通过“活动总览”查看系统所有使用的软件及快速启用惯用软件
- 在X的环境下想要“强制”重新启动X的组合按键为：“[alt]+[ctrl]+[backspace]”；
- 默认情况下，Linux提供tty1~tty6的终端机界面；
- 在终端机环境中，可依据提示字符为$或#判断为一般帐号或root帐号；
- 取得终端机支持的语系数据可下达“echo $LANG”或“locale”指令；
- date可显示日期、cal可显示日历、bc可以做为计算机软件；
- 组合按键中，[tab]按键可做为（1）命令补齐或（2）文件名补齐或（3）参数选项补齐，[crtl]-[c]可以中断目前正在运行中的程序；
- Linux 系统上的英文大小写为不同的数据
- 线上说明系统有man及info两个常见的指令；
- man page说明后面的数字中，1代表一般帐号可用指令，8代表系统管理员常用指令，5代表系统配置文件格式；
- info page可将一份说明文档拆成多个节点（node）显示，并具有类似超链接的功能，增加易读性；
- 系统需正确的关机比较不容易损坏，可使用shutdown, poweroff等指令关机。

### 练习



## 文件权限与目录配置

### 回顾

- Linux的每个文件中，可分别给予使用者、群组与其他人三种身份个别的 rwx 权限；
- 群组最有用的功能之一，就是当你在团队开发资源的时候，且每个帐号都可以有多个群组的支持；
- 利用ls -l显示的文件属性中，第一个字段是文件的权限，共有十个位，第一个位是文件类型， 接下来三个为一组共三组，为使用者、群组、其他人的权限，权限有r,w,x三种；
- 如果文件名之前多一个“ . ”，则代表这个文件为“隐藏文件”；
- 若需要root的权限时，可以使用 su - 这个指令来切换身份。处理完毕则使用 exit 离开 su 的指令环境。
- 更改文件的群组支持可用chgrp，修改文件的拥有者可用chown，修改文件的权限可用chmod
- chmod修改权限的方法有两种，分别是符号法与数字法，数字法中r,w,x分数为4,2,1；
- 对文件来讲，权限的性能为：
  - r：可读取此一文件的实际内容，如读取文本文件的文字内容等；
  - w：可以编辑、新增或者是修改该文件的内容（但不含删除该文件）；
  - x：该文件具有可以被系统执行的权限。
- 对目录来说，权限的性能为：
  - r （read contents in directory）
  - w （modify contents of directory）
  - x （access directory）
- 要开放目录给任何人浏览时，应该至少也要给予r及x的权限，但w权限不可随便给；
- 能否读取到某个文件内容，跟该文件所在的目录权限也有关系 （目录至少需要有 x 的权限）。
- Linux文件名的限制为：单一文件或目录的最大容许文件名为 255 个英文字符或 128 个中文字符；
- 根据FHS的官方文件指出， 他们的主要目的是希望让使用者可以了解到已安装软件通常放置于那个目录下
- FHS订定出来的四种目录特色为：shareable, unshareable, static, variable等四类；
- FHS所定义的三层主目录为：/, /var, /usr三层而已；
- 绝对路径文件名为从根目录 / 开始写起，否则都是相对路径的文件名。

### 练习



## 文件与目录管理

### 回顾

- 绝对路径：“一定由根目录 / 写起”；相对路径：“不由 / 写起，而是由相对当前目录写起”
- 特殊目录有：., .., -, ~, ~account需要注意；
- 与目录相关的指令有：cd, mkdir, rmdir, pwd 等重要指令；
- rmdir 仅能删除空目录，要删除非空目录需使用“ rm -r ”指令；
- 使用者能使用的指令是依据 PATH 变量所规定的目录去搜寻的；
- ls 可以检视文件的属性，尤其 -d, -a, -l 等选项特别重要！
- 文件的复制、删除、移动可以分别使用：cp, rm , mv等指令来操作；
- 检查文件的内容（读档）可使用的指令包括有：cat, tac, nl, more, less, head, tail, od 等
- cat -n 与 nl 均可显示行号，但默认的情况下，空白行会不会编号并不相同；
- touch 的目的在修改文件的时间参数，但亦可用来创建空文件；
- 一个文件记录的时间参数有三种，分别是 access time（atime）, status time （ctime）, modification time（mtime），ls 默认显示的是 mtime。
- 除了传统的rwx权限之外，在Ext2/Ext3/Ext4/xfs文件系统中，还可以使用chattr与lsattr设置及观察隐藏属性。 常见的包括只能新增数据的 +a 与完全不能更动文件的 +i 属性。
- 新建文件/目录时，新文件的默认权限使用 umask 来规范。默认目录完全权限为drwxrwxrwx， 文件则为-rw-rw-rw-。
- 文件具有SUID的特殊权限时，代表当使用者执行此一binary程序时，在执行过程中使用者会暂时具有程序拥有者的权限
- 目录具有SGID的特殊权限时，代表使用者在这个目录下面新建的文件之群组都会与该目录的群组名称相同。
- 目录具有SBIT的特殊权限时，代表在该目录下使用者创建的文件只有自己与root能够删除！
- 观察文件的类型可以使用 file 指令来观察；
- 搜寻指令的完整文件名可用 which 或 type ，这两个指令都是通过 PATH 变量来搜寻文件名；
- 搜寻文件的完整文件名可以使用 whereis 找特定目录或 locate 到数据库去搜寻，而不实际搜寻文件系统；
- 利用 find 可以加入许多选项来直接查询文件系统，以获得自己想要知道的文件名。

### 练习





## 磁盘与文件系统管理

### 回顾

- 一个可以被挂载的数据通常称为“文件系统, filesystem”而不是分区 （partition） 喔！
- 基本上 Linux 的传统文件系统为 Ext2 ，该文件系统内的信息主要有：
  - superblock：记录此 filesystem 的整体信息，包括inode/block的总量、使用量、剩余量， 以及文件系统的格式与相关信息等；
  - inode：记录文件的属性，一个文件占用一个inode，同时记录此文件的数据所在的 block 号码；
  - block：实际记录文件的内容，若文件太大时，会占用多个 block 。
- Ext2 文件系统的数据存取为索引式文件系统（indexed allocation）
- 需要磁盘重组的原因就是文件写入的 block 太过于离散了，此时文件读取的性能将会变的很差所致。 这个时候可以通过磁盘重组将同一个文件所属的 blocks 汇整在一起。
- Ext2文件系统主要有：boot sector, superblock, inode bitmap, block bitmap, inode table, data block 等六大部分。
- data block 是用来放置文件内容数据地方，在 Ext2 文件系统中所支持的 block 大小有 1K, 2K 及 4K 三种而已
- inode 记录文件的属性/权限等数据，其他重要项目为： 每个 inode 大小均为固定，有 128/256Bytes 两种基本容量。每个文件都仅会占用一个 inode 而已； 因此文件系统能够创建的文件数量与 inode 的数量有关；
- 文件的 block 在记录文件的实际数据，目录的 block 则在记录该目录下面文件名与其 inode 号码的对照表；
- 日志式文件系统 （journal） 会多出一块记录区，随时记载文件系统的主要活动，可加快系统复原时间；
- Linux 文件系统为增加性能，会让内存作为大量的磁盘高速缓存；
- 实体链接只是多了一个文件名对该 inode 号码的链接而已；
- 符号链接就类似Windows的捷径功能。
- 磁盘的使用必需要经过：分区、格式化与挂载，分别惯用的指令为：gdisk, mkfs, mount三个指令
- 分区时，应使用 parted 检查分区表格式，再判断使用 fdisk/gdisk 来分区，或直接使用 parted 分区
- 为了考虑性能，XFS 文件系统格式化时，可以考虑加上 agcount/su/sw/extsize 等参数较佳
- 如果磁盘已无未分区的容量，可以考虑使用大型文件取代磁盘设备的处理方式，通过 dd 与格式化功能。
- 开机自动挂载可参考/etc/fstab之设置，设置完毕务必使用 mount -a 测试语法正确否；

### 练习

情境仿真题一：复原本章的各例题练习，本章新增非常多 partition ，请将这些 partition 删除，恢复到原本刚安装好时的状态。

> 目标：了解到删除分区需要注意的各项信息；
>
> 前提：本章的各项范例练习你都必须要做过，才会拥有 /dev/vda4 ~ /dev/vda7 出现；
>
> 需求：熟悉 gdisk, parated, umount, swapoff 等指令。 由于本章处理完毕后，将会有许多新增的 partition ，所以请删除掉这两个 partition 。删除的过程需要注意的是：
> 以 free / swapon -s / mount 等指令查阅，要被处理的文件系统不可以被使用！ 如果有被使用，则你必须要使用  umount 卸载文件系统。如果是内存交换空间，则需使用 swapon -s 找出被使用的分区， 再以 swapoff 去卸载他！
> 使用 partprobe 使分区生效



情境仿真题二：由于我的系统原本分区的不够好，我的用户希望能够独立一个 filesystem 附挂在 /srv/myproject 目录下。  那你该如何创建新的 filesystem ，并且让这个 filesystem 每次开机都能够自动的挂载到 /srv/myproject ，  且该目录是给 project 这个群组共享的，其他人不可具有任何权限。且该 filesystem 具有 1GB 的容量。

> 目标：理解文件系统的创建、自动挂载文件系统与专案开发必须要的权限；
>
> 前提：你需要进行过第六章的情境仿真才可以继续本章；
>
> 需求：本章的所有概念必须要清楚！ 那就让我们开始来处理这个流程吧！

1. 使用 `parted` 查看分区表类型，用`gdisk/fdisk` 创建分区
2. `partprobe` 重载分区后，将新分区写入 /etc/fstab 以用于自动挂载，使用 `mount -a` 测试语法正确，`df` 检查挂载成功
3. 通过`chgrp`和`chmod`设置 用户组 和 GUID

## 文件与文件系统的压缩/打包/备份

### 回顾

### 练习

1. 找出 /etc 下面 （不含子目录） 容量最大的文件，并将它复制到 /tmp ，然后以 gzip 压缩
2. a
3. a
4. a